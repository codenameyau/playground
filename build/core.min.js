/*!
 * ThreeJSCore - core.js
 * Author: Jorge Yau <codenameyau@gmail.com>
 * https://github.com/codenameyau/playground/core
 * MIT License (c) 2017
 */
function ThreeJSCore(e){this.version="v2.0.0",this.options=e||{},this.clock=null,this.scene=null,this.animation=null,this.renderer=null,this.camera=null,this.controls=null,this.settings={},this.HUD={},this._initializeSettings(),this._intializeKeycodes(),this._initializeClock(),this._initializeScene(),this._initializeRenderer(),this._initializeCamera(),this._initializeControls(),this._initializeHUD(),this._initializeEventListeners(),this.updateScene()}THREE.OrbitControls=function(e,t){function i(){return 2*Math.PI/60/60*d.autoRotateSpeed}function n(){return Math.pow(.95,d.userZoomSpeed)}function o(e){d.enabled!==!1&&d.userRotate!==!1&&(e.preventDefault(),g===b.NONE&&(0===e.button&&(g=b.ROTATE),1===e.button&&(g=b.ZOOM),2===e.button&&(g=b.PAN)),g===b.ROTATE?p.set(e.clientX,e.clientY):g===b.ZOOM?T.set(e.clientX,e.clientY):g===b.PAN,document.addEventListener("mousemove",r,!1),document.addEventListener("mouseup",s,!1))}function r(e){if(d.enabled!==!1)if(e.preventDefault(),g===b.ROTATE)m.set(e.clientX,e.clientY),E.subVectors(m,p),d.rotateLeft(2*Math.PI*E.x/l*d.userRotateSpeed),d.rotateUp(2*Math.PI*E.y/l*d.userRotateSpeed),p.copy(m);else if(g===b.ZOOM)f.set(e.clientX,e.clientY),y.subVectors(f,T),y.y>0?d.zoomIn():d.zoomOut(),T.copy(f);else if(g===b.PAN){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,i=e.movementY||e.mozMovementY||e.webkitMovementY||0;d.pan(new THREE.Vector3(-t,i,0))}}function s(){d.enabled!==!1&&d.userRotate!==!1&&(document.removeEventListener("mousemove",r,!1),document.removeEventListener("mouseup",s,!1),g=b.NONE)}function a(e){if(d.enabled!==!1&&d.userZoom!==!1){var t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=-e.detail),t>0?d.zoomOut():d.zoomIn()}}function h(e){if(d.enabled!==!1&&d.userPan!==!1)switch(e.keyCode){case d.keys.ROTATE:g=b.ROTATE;break;case d.keys.ZOOM:g=b.ZOOM;break;case d.keys.PAN:g=b.PAN}}function c(e){switch(e.keyCode){case d.keys.ROTATE:case d.keys.ZOOM:case d.keys.PAN:g=b.NONE}}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.center=new THREE.Vector3,this.userZoom=!0,this.userZoomSpeed=1,this.userRotate=!0,this.userRotateSpeed=1,this.userPan=!0,this.userPanSpeed=2,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minDistance=0,this.maxDistance=1/0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,ROTATE:65,ZOOM:83,PAN:68};var d=this,u=1e-6,l=1800,p=new THREE.Vector2,m=new THREE.Vector2,E=new THREE.Vector2,T=new THREE.Vector2,f=new THREE.Vector2,y=new THREE.Vector2,w=0,v=0,S=1,C=new THREE.Vector3,b={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},g=b.NONE,R={type:"change"};this.rotateLeft=function(e){void 0===e&&(e=i()),v-=e},this.rotateRight=function(e){void 0===e&&(e=i()),v+=e},this.rotateUp=function(e){void 0===e&&(e=i()),w-=e},this.rotateDown=function(e){void 0===e&&(e=i()),w+=e},this.zoomIn=function(e){void 0===e&&(e=n()),S/=e},this.zoomOut=function(e){void 0===e&&(e=n()),S*=e},this.pan=function(e){e.transformDirection(this.object.matrix),e.multiplyScalar(d.userPanSpeed),this.object.position.add(e),this.center.add(e)},this.update=function(){var e=this.object.position,t=e.clone().sub(this.center),n=Math.atan2(t.x,t.z),o=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);this.autoRotate&&this.rotateLeft(i()),n+=v,o+=w,o=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,o)),o=Math.max(u,Math.min(Math.PI-u,o));var r=t.length()*S;r=Math.max(this.minDistance,Math.min(this.maxDistance,r)),t.x=r*Math.sin(o)*Math.sin(n),t.y=r*Math.cos(o),t.z=r*Math.sin(o)*Math.cos(n),e.copy(this.center).add(t),this.object.lookAt(this.center),v=0,w=0,S=1,C.distanceTo(this.object.position)>0&&(this.dispatchEvent(R),C.copy(this.object.position))},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mousewheel",a,!1),this.domElement.addEventListener("DOMMouseScroll",a,!1),window.addEventListener("keydown",h,!1),window.addEventListener("keyup",c,!1)},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);var options={dom:"#threejs-canvas",antialias:!0},core=new ThreeJSCore(options);core.enableGrid(40,4),core.setCameraPosition(0,60,90);var lightAmbient=new THREE.AmbientLight(5921370),lightSource=new THREE.PointLight(11201146);lightSource.position.set(0,20,70),core.scene.add(lightAmbient),core.scene.add(lightSource);var size=8,material=new THREE.MeshLambertMaterial,geometry=new THREE.BoxGeometry(size,size,size);geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,size/2,0));var boxMesh=new THREE.Mesh(geometry,material);core.scene.add(boxMesh),ThreeJSCore.prototype._initializeSettings=function(){this.settings.dom=this.options.dom||"#threejs-canvas",this.settings.grid=!1,this.settings.renderer={antialias:this.options.antialias||!1},this.settings.camera={fov:45,near:.5,far:1e4,pos:{x:0,y:60,z:120}},this.settings.controls={enabled:!0,userPan:!1,userPanSpeed:.5,minDistance:10,maxDistance:600,maxPolarAngle:Math.PI/180*85},this.animation=this.defaultAnimation},ThreeJSCore.prototype._intializeKeycodes=function(){this.keycodes={backspace:8,enter:13,shift:16,ctrl:17,alt:18,caps:20,esc:27,space:32,end:35,home:36,left:37,up:38,right:39,down:40,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90}},ThreeJSCore.prototype._initializeClock=function(){this.clock=new THREE.Clock,this.clock.delta=this.clock.getDelta()},ThreeJSCore.prototype._initializeScene=function(){this.scene=new THREE.Scene},ThreeJSCore.prototype._initializeRenderer=function(){this.renderer=new THREE.WebGLRenderer(this.settings.renderer),this.renderer.setSize(window.innerWidth,window.innerHeight),this.utils.addToDOM(this.settings.dom,this.renderer.domElement),this.renderer.running=!0},ThreeJSCore.prototype._initializeCamera=function(){var e=this.settings.camera,t=window.innerWidth/window.innerHeight;this.camera=new THREE.PerspectiveCamera(e.fov,t,e.near,e.far),this.camera.position.set(e.pos.x,e.pos.y,e.pos.z),this.camera.lookAt(this.scene.position),this.scene.add(this.camera)},ThreeJSCore.prototype._initializeControls=function(){var e=this.settings.controls;this.controls=new THREE.OrbitControls(this.camera);for(var t in e){if(!e.hasOwnProperty(t))return;this.controls[t]=e[t]}},ThreeJSCore.prototype._initializeHUD=function(){this.enablePausedHUD()},ThreeJSCore.prototype._initializeEventListeners=function(){window.addEventListener("resize",this.resizeWindow.bind(this),!1),window.addEventListener("focus",this.resumeClock.bind(this),!1),window.addEventListener("blur",this.pauseClock.bind(this),!1),window.addEventListener("keydown",this.keyboardInput.bind(this),!1)},ThreeJSCore.prototype._callback=function(e){e&&"function"==typeof e&&e.bind(this)()},ThreeJSCore.prototype.renderScene=function(){this.renderer.render(this.scene,this.camera)},ThreeJSCore.prototype.updateScene=function(){this.renderer.running&&(window.requestAnimationFrame(this.updateScene.bind(this)),this.animation())},ThreeJSCore.prototype.resizeWindow=function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},ThreeJSCore.prototype.resumeClock=function(){this.clock.start()},ThreeJSCore.prototype.pauseClock=function(){this.clock.stop()},ThreeJSCore.prototype.resumeRenderer=function(){this.renderer.running=!0,this.resumeClock(),window.requestAnimationFrame(this.updateScene.bind(this))},ThreeJSCore.prototype.pauseRenderer=function(){this.renderer.running=!1,this.pauseClock()},ThreeJSCore.prototype.togglePause=function(){this.renderer.running?(this.HUD.paused.style.display="block",this.controls.enabled=!1,this.pauseRenderer()):(this.HUD.paused.style.display="none",this.controls.enabled=!0,this.resumeRenderer())},ThreeJSCore.prototype.getKeycode=function(e){return this.keycodes[e]},ThreeJSCore.prototype.defaultAnimation=function(){this.controls.update(),this.renderScene()},ThreeJSCore.prototype.setAnimation=function(e){this.animation=e},ThreeJSCore.prototype.enableGrid=function(e,t,i){e=e||80,t=t||4,i=i||16777215;for(var n=new THREE.Geometry,o=new THREE.LineBasicMaterial({color:i}),r=-e;e>=r;r+=t)n.vertices.push(new THREE.Vector3(-e,0,r)),n.vertices.push(new THREE.Vector3(e,0,r)),n.vertices.push(new THREE.Vector3(r,0,-e)),n.vertices.push(new THREE.Vector3(r,0,e));this.scene.add(new THREE.Line(n,o,THREE.LinePieces)),this.settings.grid=!0},ThreeJSCore.prototype.loadScene=function(e){this._callback(e)},ThreeJSCore.prototype.setMaxCameraDistance=function(e){this.settings.camera.far=e,this.camera.far=e,this.camera.updateProjectionMatrix()},ThreeJSCore.prototype.setCameraPosition=function(e,t,i){this.camera.position.set(e,t,i),this.settings.camera.pos.x=e,this.settings.camera.pos.y=t,this.settings.camera.pos.z=i},ThreeJSCore.prototype.resetCamera=function(e){this._initializeCamera(),this._initializeControls(),this._callback(e)},ThreeJSCore.prototype.resetScene=function(e){this._initializeScene(),this.resetCamera(),this.settings.grid&&this.enableGrid(),this._callback(e)},ThreeJSCore.prototype.utils={},ThreeJSCore.prototype.utils.addToDOM=function(e,t){var i=document.querySelector(e);i&&i.appendChild(t)},ThreeJSCore.prototype.utils.checkProperty=function(e,t,i){return e&&"undefined"!=typeof e[t]&&(i=e[t]),i},ThreeJSCore.prototype.utils.degToRad=function(e){return Math.PI/180*e},ThreeJSCore.prototype.utils.radToDeg=function(e){return 180/Math.PI*e},ThreeJSCore.prototype.utils.random=function(e,t){return parseInt(Math.random()*(t-e)+e,10)},ThreeJSCore.prototype.utils.randomInclusive=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},ThreeJSCore.prototype.utils.randomNormal=function(e,t){var i=this.randomInclusive(e,t),n=this.randomInclusive(e,t);return parseInt((i+n)/2,10)},ThreeJSCore.prototype.enablePausedHUD=function(){var e=document.createElement("div");e.className="threejs-core-pause",e.textContent="Paused",this.utils.addToDOM(this.settings.dom,e),this.HUD.paused=e},ThreeJSCore.prototype.keyboardInput=function(e){switch(e.which){case this.keycodes.space:e.preventDefault(),this.togglePause();break;case this.keycodes.r:e.preventDefault(),this.resetCamera()}};